name: CI

on:
  push:
    branches: [main]
  pull_request:
  schedule:
    - cron: "0 9 * * 1" # Monday 9am UTC
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install markdownlint-cli
        run: npm install -g markdownlint-cli

      - name: Install prettier
        run: npm install -g prettier

      - name: Install vale
        run: |
          wget -q https://github.com/errata-ai/vale/releases/download/v3.9.0/vale_3.9.0_Linux_64-bit.tar.gz
          tar -xzf vale_3.9.0_Linux_64-bit.tar.gz vale
          sudo mv vale /usr/local/bin/
          vale sync

      - name: Run markdownlint and vale
        run: |
          markdownlint '**/*.md' --ignore .vale
          vale how/*.md why/*.md CLAUDE.md

      - name: Check formatting
        run: make check

      - name: Check internal links
        uses: lycheeverse/lychee-action@v2
        with:
          args: --offline '**/*.md'

      - name: Check external links
        uses: lycheeverse/lychee-action@v2
        if: github.event_name == 'schedule'
        with:
          args: '**/*.md'
